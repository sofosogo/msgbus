/* msgbus | https://github.com/sofosogo/msgbus | MIT Licensed */(function(){function a(a){this.prefix=a?a+".":"",f[a||""]=this}function g(a){return c[a]||(c[a]={})}function h(a,b,c,d){var e=new i(b,c,d);return typeof d.enable=="string"&&a.listen(d.enable,function(a){a?e.enable():e.disable()}),e}function i(a,c,d){this._id=b++,this._msg=a,this._opt=d,this._notify=k(c,d.thisp)}function j(a,b,c,d){d=d||{},this._data={},this._listener={};var e=k(c,d.thisp),f=this,g;this._handle=function(){for(var a=0;a<b.length;a++)if(this._data[b[a]]===void 0)return;e(this._data),d.clean_after_fire&&this.clean()};for(var h=0;h<b.length;h++)g=a.listen(b[h],function(){var a=b[h];return function(b){f.put(a,b)}}()),f._listener[g._id]=g}function k(a,b){if(typeof a=="string"&&b)return function(c){b[a](c)};if(typeof a=="function"&&b)return function(c){a.call(b,c)};if(typeof a=="function")return function(b){a(b)};throw TypeError("Cannot create a listener.")}function l(a,b){var c=g(a),d=new Date,e,f;for(var h in c){f=c[h],e=f._opt;if(e.min_interval){if(f._lastCalled&&d-f._lastCalled<e.min_interval)continue;f._lastCalled=d}try{f._handle(b)}catch(i){e.error&&e.error.call(e.thisp||f,i,b)}}}a.prototype={listen:function(a,b,c){var d=this.signal(a);if(d!==void 0){var e=this;setTimeout(function(){e.fire(a,d)},0)}this.prefix&&(a=this.prefix+a);var f=h(this,a,b,c||{});return g(a)[f._id]=f},wait:function(a,b,c){return c=c||{},c.once=!0,this.listen(a,b,c)},join:function(a,b,c){return new j(this,a,b,c)},fire:function(a,b,c){var d=c&&c.async!==void 0?c.async:this.global("async");return this.prefix&&(a=this.prefix+a),d?setTimeout(function(){l(a,b)},0):l(a,b),this},signal:function(a,b,c){var e=this.prefix?this.prefix+a:a;return b===void 0?d[e]:(d[e]=b,this.fire(a,b,c))},global:function(a,b){return b===void 0?e[a]:(e[a]=b,this)},getInstance:function(b){return f[b||""]||new a(b)}};var b=0,c={},d={},e={async:!1},f={};i.prototype={_handle:function(a){this.enabled===!1?this._delay=function(){this._notify(a)}:this._notify(a),this._opt.once&&this.remove()},remove:function(){delete g(this._msg)[this._id]},disable:function(){return this.enabled=!1,this},enable:function(){return this.enabled=!0,this._delay&&(this._delay(),delete this._delay),this},error:function(a){return this._opt.error=a,this},opt:function(a,b){return b===void 0?this._opt[a]:(this._opt[a]=b,this)}},j.prototype={put:function(a,b){return this._data[a]=b,this._handle(),this},clean:function(){return this._data={},this},remove:function(){for(var a in this._listener)this._listener[a].remove();return this}};var m=new a;if(typeof module!="undefined"&&module.exports)module.exports=m;else{var n=window.MsgBus;a.prototype.noConflict=function(){return window.msgbus=n,m},window.msgbus=m}})();